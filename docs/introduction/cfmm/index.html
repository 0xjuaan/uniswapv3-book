<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Constant Function Market Makers #    \[ \]  As I mentioned in the previous section, there are different approach to building AMM. We&rsquo;ll be focusing and building one specific type of AMM–Constant Function Market Maker. Don&rsquo;t be scared by the long name! At its core is a very simply mathematical formula:
$$x * y = k$$
That&rsquo;s it, that&rsquo;s the formula.
\(x\) and \(y\) are pool contract reserves–the amount of tokens it current holds."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Constant Function Market Makers"><meta property="og:description" content="Constant Function Market Makers #    \[ \]  As I mentioned in the previous section, there are different approach to building AMM. We&rsquo;ll be focusing and building one specific type of AMM–Constant Function Market Maker. Don&rsquo;t be scared by the long name! At its core is a very simply mathematical formula:
$$x * y = k$$
That&rsquo;s it, that&rsquo;s the formula.
\(x\) and \(y\) are pool contract reserves–the amount of tokens it current holds."><meta property="og:type" content="article"><meta property="og:url" content="https://jeiwan.net/uniswapv3-book/docs/introduction/cfmm/"><meta property="article:section" content="docs"><title>Constant Function Market Makers | Uniswap V3 Development Book</title><link rel=manifest href=/uniswapv3-book/manifest.json><link rel=icon href=/uniswapv3-book/favicon.png type=image/x-icon><link rel=stylesheet href=/uniswapv3-book/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous><script defer src=/uniswapv3-book/flexsearch.min.js></script>
<script defer src=/uniswapv3-book/en.search.min.8ea711323695b937c57d0958130c4341f07d34949c08a837579cd286dcb84b60.js integrity="sha256-jqcRMjaVuTfFfQlYEwxDQfB9NJScCKg3V5zShty4S2A=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/uniswapv3-book/><span>Uniswap V3 Development Book</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Milestone 0</span><ul><li><a href=/uniswapv3-book/docs/introduction/amm/>Introduction to markets</a></li><li><a href=/uniswapv3-book/docs/introduction/cfmm/ class=active>Constant Function Market Makers</a></li></ul></li><li class=book-section-flat><span>Milestone 1</span><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/uniswapv3-book/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Constant Function Market Makers</strong>
<label for=toc-control><img src=/uniswapv3-book/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#constant-function-market-makers>Constant Function Market Makers</a><ul><li><a href=#the-trade-function>The trade function</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=constant-function-market-makers>Constant Function Market Makers
<a class=anchor href=#constant-function-market-makers>#</a></h1><link rel=stylesheet href=/uniswapv3-book/katex/katex.min.css><script defer src=/uniswapv3-book/katex/katex.min.js></script>
<script defer src=/uniswapv3-book/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><span>
\[ \]</span><p>As I mentioned in the previous section, there are different approach to building AMM. We&rsquo;ll be focusing and building one
specific type of AMM–Constant Function Market Maker. Don&rsquo;t be scared by the long name! At its core is a very
simply mathematical formula:</p><p>$$x * y = k$$</p><p>That&rsquo;s it, that&rsquo;s the formula.</p><p>\(x\) and \(y\) are pool contract reserves–the amount of tokens it current holds. <em>k</em> is just their product, actual
value doesn&rsquo;t matter.</p><blockquote><p><strong>Why there are only two reserves, <em>x</em> and <em>y</em>?</strong><br>Each Uniswap pool can hold only two tokens. We use <em>x</em> and <em>y</em> to refer to reserves of one pool, where <em>x</em> is the reserve
of the first token and <em>y</em> is the reserve of the other token, and the order doesn&rsquo;t matter.</p></blockquote><p>The constant function formula says: <strong>after each trade, <em>k</em> must remain unchanged</strong>. When traders make trades, they
put some amount of one token into pool (token they want to seel) and remove some amount of the other token from pool
(token they want to buy). This changes the reserves of the pool, and the constant function formula says that <strong>the product</strong>
of reserves must not change. As we will see many times in this book, this simple requirement makes the whole design work
and satisfies many non-obvious implications.</p><h2 id=the-trade-function>The trade function
<a class=anchor href=#the-trade-function>#</a></h2><p>Now that we know what pools are, let&rsquo;s write a formula of how trading happens in a pool:</p><p>$$(x + r\Delta x)(y - \Delta y) = k$$</p><p>[TODO: illustration]</p><ol><li>There&rsquo;s a pool with some amount of token A (\(x\)) and some amount of token B (\(y\)).</li><li>When we buy token B for token A, we give some amount of token A to the pool (\(\Delta x\)).</li><li>The pool gives us some amount of token B in exchange (\(\Delta y\)).</li><li>The pool also takes a small fee from the amount of token A we gave (\(r\)).</li><li>The reserve of token A changes (\(x + r \Delta x\)), and the reserve of token B changes as well (\(y - \Delta y\)).</li><li>The product of updated reserves must still equal to \(k\).</li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#constant-function-market-makers>Constant Function Market Makers</a><ul><li><a href=#the-trade-function>The trade function</a></li></ul></li></ul></nav></div></aside></main></body></html>